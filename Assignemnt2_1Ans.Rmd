---
title: "Assignment2_Ans"
author: "STAT380"
date: '2023-10-29'
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r }
###
library(tree)
###
library(ISLR)
#attach(Carseats)
library(rattle)
library(rpart.plot)
library(RColorBrewer)
library(partykit)
```
The data set `Carseats' is a simulated data set containing sales of child car seats at 400 different stores of a specific departmental store over a period of a few months.  For the different activities in this assignment, we consider a categorical binary variable, that we call 'High_Sales'.  We consider the sales amount is high, i.e., High_Sales=1,  if the number of  car sets that are sold is greater than 8 in the particular store. 

# Problem A
### A1.  Create a new binary categorical variable called `High_Sales' which is defined as follows: 
$ \text{High_Sales}='High' \text{ if } `Sales'>8 $ and $ \text{High_Sales}=0'Low'\text{ if } `Sales'\leq 8 $

### A2. Add the new variable to the dataset `Carseats'.
```{r }
data(Carseats)
### A1.
High_Sales<-ifelse(Carseats$Sales>8, 'High', 'Low')

### A2.
Carseats$High_Sales=as.factor(High_Sales)
```


### A3. Build a classification tree where the response is 'High_Sales' and the predictors are all the other variables except 'Sales' and 'High_Sales'.
```{r }
names(Carseats)
### A3.
fit = rpart(High_Sales~CompPrice+Income+Advertising+Population+Price+ShelveLoc+Age+Education+Urban+US,data=Carseats,method="class",minsplit=20,cp=-1)

```
###

### A4.1 Plot the fitted tree and 
#### A4.2 describe the different classification region. 
```{r }

# A4.1 Plot the regression tree
plot(fit)
plot(as.party(fit)) # Basic Plot 
fancyRpartPlot(fit, caption = NULL) # More Nicer plot but need libraries `RColorBrewer', `rattle' and `rpart.plot'



#A4.2 describe the different classification region.

```

## Training and Testing Set
### A5.1. Now, Create a training set and a testing set , use a training set (70% in the training Set and 30% in test set). 

```{r }
#### A5.1:
set.seed(234)
 #inTrain = createDataPartition(Carseats$Sales, p = 0.75, list = FALSE)
  Total_data_size=as.integer(nrow(Carseats))
  inTrain = sample(1:Total_data_size, round(Total_data_size*.70))
  Training_Set = Carseats[inTrain, ]
  dim(Training_Set)
  Testing_Set<-Carseats[-inTrain, ]
  dim(Testing_Set)
```

### A5.2. Fit the Classification Tree  in the Training set and Plot the tree

```{r }
### A5.2.
fit_train = rpart(High_Sales~CompPrice+Income+Advertising+Population+Price+ShelveLoc+Age+Education+Urban+US,data=Training_Set,method="class",minsplit=20,cp=-1)



# plot mytree
fancyRpartPlot(fit_train, caption = NULL)
```



### A6. Comment on the Error Rate in the validation part.
Identify an optimal value for complexiety parameter `cp'.
Note: cp = “value” is an assigned numeric value that will determine how tall a tree is to be  growen. The smaller value (closer to 0) leads to  the larger the trees. The default value is 0.01.
```{r }
summary(fit_train)
printcp(fit_train)
plotcp(fit_train) 
```

### A7. Prune the tree According to the optimal value of cp that you have obtainied in A6. 
```{r }
### A8.

bestcp <-fit_train$cptable[which.min(fit_train$cptable[,"xerror"]),"CP"]
pruned.tree <- prune(fit_train, cp = bestcp)
rpart.plot(pruned.tree)

```
###

### A8.1 Predict on the Testing set with the pruned tree and
### A8.2 Predict on the Testing set with the pruned tree andPredict on the Testing set with the entire tree fitted using the training set
```{r }
### A8.1
# Alternate specification 
pred_test.prune = predict(pruned.tree, Testing_Set, type="class")

### A8.1
pred_test.full_tree=predict(fit_train, Testing_Set, type="class")
```
### A9.1 Create A classification Tables of the errors  using the Predicted values from the pruned tree
### A9.2 Create A classification Tables of the errors  using the Predicted values from entire tree fitted using the training set
###

### A10. Compare the classification performance of the tree and the pruned tree. 
```{r }
#A9.1
table(pred_test.prune,Testing_Set$High_Sales )
#A9.2
table(pred_test.full_tree,Testing_Set$High_Sales )
## Write a Conslusion of your finding
```



# Problem B (Fitting Regression Trees)


### We will use the regression trees for the Boston Housing data


## B1. Train a regression tree on the half of the observations of the Boston housing data. Comment no the Result.


```{r }
##

```

## B2. Plot the tree.

```{r }
##

```
###

## B3. Run the cross-validation for the tree and plot the errors.

```{r }
##

```
###

## B4. Prune the regression tree to find the optimal number of nodes.

```{r }
##

```
###

## B5. Plot the predicted values vs the test values and calculate the MSE. Comment on the obtained results.


```{r }
##

```